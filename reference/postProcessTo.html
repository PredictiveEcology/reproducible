<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Transform a GIS dataset so it has the properties (extent, projection, mask) of another — postProcessTo • reproducible</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Transform a GIS dataset so it has the properties (extent, projection, mask) of another — postProcessTo"><meta property="og:description" content='This function provides a single step to achieve the GIS operations
"pre-crop-with-buffer-to-speed-up-projection", "project",
"post-projection-crop", "mask" and possibly "write".
It uses primarily the terra package internally
(with some minor functions from sf)
in an attempt to be as efficient as possible, except if all inputs are sf objects.
(in which case sf is used). Currently, this function is tested
with sf, SpatVector, SpatRaster, Raster* and Spatial* objects passed
to from, and the same plus SpatExtent, and crs passed to to or the
relevant *to functions.
For this function, Gridded means a Raster* class object from raster or
a SpatRaster class object from terra.
Vector means a Spatial* class object from sp, a sf class object
from sf, or a SpatVector class object from terra.
This function is also used internally with the deprecated family postProcess(),
*Inputs, such as cropInputs().'><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-58633549-5"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-58633549-5');
</script></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">reproducible</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/Intro-to-Cache.html">Introduction to Cache</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/PredictiveEcology/reproducible/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Transform a GIS dataset so it has the properties (extent, projection, mask) of another</h1>
    <small class="dont-index">Source: <a href="https://github.com/PredictiveEcology/reproducible/blob/master/R/postProcessTo.R" class="external-link"><code>R/postProcessTo.R</code></a></small>
    <div class="hidden name"><code>postProcessTo.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function provides a single step to achieve the GIS operations
"pre-crop-with-buffer-to-speed-up-projection", "project",
"post-projection-crop", "mask" and possibly "write".
It uses primarily the <code>terra</code> package internally
(with some minor functions from <code>sf</code>)
in an attempt to be as efficient as possible, except if all inputs are <code>sf</code> objects.
(in which case <code>sf</code> is used). Currently, this function is tested
with <code>sf</code>, <code>SpatVector</code>, <code>SpatRaster</code>, <code>Raster*</code> and <code>Spatial*</code> objects passed
to <code>from</code>, and the same plus <code>SpatExtent</code>, and <code>crs</code> passed to <code>to</code> or the
relevant <code>*to</code> functions.
For this function, Gridded means a <code>Raster*</code> class object from <code>raster</code> or
a <code>SpatRaster</code> class object from <code>terra</code>.
Vector means a <code>Spatial*</code> class object from <code>sp</code>, a <code>sf</code> class object
from <code>sf</code>, or a <code>SpatVector</code> class object from <code>terra</code>.
This function is also used internally with the deprecated family <code><a href="postProcess.html">postProcess()</a></code>,
<code>*Inputs</code>, such as <code><a href="deprecated.html">cropInputs()</a></code>.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">postProcessTo</span><span class="op">(</span></span>
<span>  <span class="va">from</span>,</span>
<span>  <span class="va">to</span>,</span>
<span>  cropTo <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  projectTo <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  maskTo <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  writeTo <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"reproducible.verbose"</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">postProcessTerra</span><span class="op">(</span></span>
<span>  <span class="va">from</span>,</span>
<span>  <span class="va">to</span>,</span>
<span>  cropTo <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  projectTo <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  maskTo <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  writeTo <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"reproducible.verbose"</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">maskTo</span><span class="op">(</span></span>
<span>  <span class="va">from</span>,</span>
<span>  <span class="va">maskTo</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"reproducible.verbose"</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">projectTo</span><span class="op">(</span></span>
<span>  <span class="va">from</span>,</span>
<span>  <span class="va">projectTo</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"reproducible.verbose"</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">cropTo</span><span class="op">(</span></span>
<span>  <span class="va">from</span>,</span>
<span>  cropTo <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  needBuffer <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"reproducible.verbose"</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">writeTo</span><span class="op">(</span></span>
<span>  <span class="va">from</span>,</span>
<span>  <span class="va">writeTo</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"reproducible.overwrite"</span><span class="op">)</span>,</span>
<span>  isStack <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  isBrick <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  isRaster <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  isSpatRaster <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  verbose <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"reproducible.verbose"</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-from">from<a class="anchor" aria-label="anchor" href="#arg-from"></a></dt>
<dd><p>A Gridded or Vector dataset on which to do one or more of:
crop, project, mask, and write</p></dd>


<dt id="arg-to">to<a class="anchor" aria-label="anchor" href="#arg-to"></a></dt>
<dd><p>A Gridded or Vector dataset which is the object
whose metadata will be the target for cropping, projecting, and masking of <code>from</code>.</p></dd>


<dt id="arg-cropto">cropTo<a class="anchor" aria-label="anchor" href="#arg-cropto"></a></dt>
<dd><p>Optional Gridded or Vector dataset which,
if supplied, will supply the extent with which to crop <code>from</code>. To omit
cropping completely, set this to <code>NA</code>. If supplied, this will override <code>to</code>
for the cropping step. Defaults to <code>NULL</code>, which means use <code>to</code></p></dd>


<dt id="arg-projectto">projectTo<a class="anchor" aria-label="anchor" href="#arg-projectto"></a></dt>
<dd><p>Optional Gridded or Vector dataset, or <code>crs</code> object (e.g., sf::st_crs).
If Gridded it will supply
the <code>crs</code>, <code>extent</code>, <code>res</code>, and <code>origin</code>
to project the <code>from</code> to. If Vector, it will provide the <code>crs</code> only.
The resolution and extent will be taken from <code>res(from)</code> (i.e. <code>ncol(from)*nrow(from)</code>).
If a Vector, the extent of the <code>projectTo</code> is not used (unless it is also passed to <code>cropTo</code>.
To omit projecting, set this to <code>NA</code>.
If supplied, this will override <code>to</code> for the projecting step.
Defaults to <code>NULL</code>, which means use <code>to</code>.
<strong>Attention.</strong> Conflicts may arise with when <code>projectTo</code> is a Vector/CRS object with a
distinct CRS from <code>to</code>. Because <code>to</code> is used for masking <em>after</em> <code>from</code> is re-projected using
<code>projectTo</code>, the extents of <code>to</code> and <code>from</code> may no longer overlap (as in <em>align</em>)
perfectly leading to failure during
the masking step. We  recommend passing a raster templates to <code>projectTo</code> whose extent and CRS
are both compatible with the object used later for masking (either <code>to</code> or <code>maskTo</code>).</p></dd>


<dt id="arg-maskto">maskTo<a class="anchor" aria-label="anchor" href="#arg-maskto"></a></dt>
<dd><p>Optional Gridded or Vector dataset which,
if supplied, will supply the extent with which to mask <code>from</code>.
If Gridded, it will mask with the <code>NA</code> values on the <code>maskTo</code>;
if Vector, it will mask on the <code>terra::aggregate(maskTo)</code>.
To omit masking completely, set this to <code>NA</code>.
If supplied, this will override <code>to</code> for the masking step.
Defaults to <code>NULL</code>, which means use <code>to</code></p></dd>


<dt id="arg-writeto">writeTo<a class="anchor" aria-label="anchor" href="#arg-writeto"></a></dt>
<dd><p>Optional character string of a filename to use <code>writeRaster</code> to save the final
object. Default is <code>NULL</code>, which means there is no <code>writeRaster</code></p></dd>


<dt id="arg-overwrite">overwrite<a class="anchor" aria-label="anchor" href="#arg-overwrite"></a></dt>
<dd><p>Logical. Used if <code>writeTo</code> is not <code>NULL</code>; also if <code>terra</code> determines
that the object requires writing to disk during a <code>crop</code>, <code>mask</code> or <code>project</code> call
e.g., because it is too large.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Numeric, -1 silent (where possible), 0 being very quiet,
1 showing more messaging, 2 being more messaging, etc.
Default is 1. Above 3 will output much more information about the internals of
Caching, which may help diagnose Caching challenges. Can set globally with an
option, e.g., <code>options('reproducible.verbose' = 0) to reduce to minimal</code></p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Arguments passed to <code><a href="https://rspatial.github.io/terra/reference/mask.html" class="external-link">terra::mask</a></code> (for <code>maskTo</code>), <code><a href="https://rspatial.github.io/terra/reference/project.html" class="external-link">terra::project</a></code> (for <code>projectTo</code>)
or <code><a href="https://rspatial.github.io/terra/reference/writeRaster.html" class="external-link">terra::writeRaster</a></code> (for <code>writeTo</code>) and not used for <code>cropTo</code>, as well <code>postProcess</code>'s
<code>rasterToMatch</code> and <code>studyArea</code> arguments (see below). Commonly used arguments might be
<code>method</code>, <code>touches</code>, and <code>datatype</code>. If <code>filename</code> is passed, it will be ignored; use
<code>writeTo = </code>. If <code>reproducible.gdalwarp = TRUE</code>, then these will be passed to the
<code>gdal*</code> functions. See them for details.</p></dd>


<dt id="arg-needbuffer">needBuffer<a class="anchor" aria-label="anchor" href="#arg-needbuffer"></a></dt>
<dd><p>Logical. Defaults to <code>FALSE</code>, meaning nothing is done out
of the ordinary. If <code>TRUE</code>, then a buffer around the cropTo, so that if a reprojection
has to happen on the <code>cropTo</code> prior to using it as a crop layer, then a buffer
of 1.5 * res(cropTo) will occur prior, so that no edges are cut off.</p></dd>


<dt id="arg-isstack-isbrick-israster-isspatraster">isStack, isBrick, isRaster, isSpatRaster<a class="anchor" aria-label="anchor" href="#arg-isstack-isbrick-israster-isspatraster"></a></dt>
<dd><p>Logical. Default <code>NULL</code>. Used to convert <code>from</code>
back to these classes prior to writing, if provided.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>An object of the same class as <code>from</code>, but potentially cropped (via <code>cropTo()</code>),
projected (via <code>projectTo()</code>), masked (via <code>maskTo()</code>), and written to disk
(via <code>writeTo()</code>).</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p><code>postProcessTo</code> is a wrapper around (an initial "wide" crop for speed)
<code>cropTo(needBuffer = TRUE)</code>, <code>projectTo</code>,
<code>cropTo</code> (the actual crop for precision), <code>maskTo</code>, <code>writeTo</code>.
Users can call each of these individually.</p>
<p><code>postProcessTerra</code> is the early name of this function that is now <code>postProcessTo</code>.</p>
<p>This function is meant to replace <code><a href="postProcess.html">postProcess()</a></code> with the more efficient
and faster <code>terra</code> functions.</p>
    </div>
    <div id="use-cases">
    <h2>Use Cases</h2>



<p>The table below shows what will result from passing different classes to <code>from</code>
and <code>to</code>:</p>
<table class="table table"><tr><td><strong><code>from</code></strong></td><td><strong><code>to</code></strong></td><td><strong><code>from</code></strong> will have:</td></tr><tr><td><code>Gridded</code></td><td><code>Gridded</code></td><td>the extent, projection, origin, resolution
and masking where there are <code>NA</code> from the <code>to</code></td></tr><tr><td><code>Gridded</code></td><td><code>Vector</code></td><td>the projection, origin, and mask from <code>to</code>, and
extent will be a round number of pixels that
fit within the extent of <code>to</code>. Resolution will
be the same as <code>from</code>.  See section
below about <code>projectTo</code>.</td></tr><tr><td><code>Vector</code></td><td><code>Vector</code></td><td>the projection, origin, extent and mask from <code>to</code></td></tr></table><p>If one or more of the <code>*To</code> arguments are supplied, these will
override individual components of <code>to</code>. If <code>to</code> is omitted or <code>NULL</code>,
then only the <code>*To</code> arguments that are used will be performed. In all cases,
setting a <code>*To</code> argument to <code>NA</code> will prevent that step from happening.</p>
    </div>
    <div id="projectto">
    <h2><code>projectTo</code></h2>


<p>Since these functions use the gis capabilities of <code>sf</code> and <code>terra</code>, they will only
be able to do things that those functions can do. One key caution, which is
stated clearly in <code><a href="https://rspatial.github.io/terra/reference/project.html" class="external-link">?terra::project</a></code> is that projection of a raster (i.e., gridded)
object should always be with another gridded object. If the user chooses to
supply a <code>projectTo</code> that is a vector object for a <code>from</code> that is gridded,
there may be unexpected failures due e.g., to extents not overlapping during
the <code>maskTo</code> stage.</p>
    </div>
    <div id="backwards-compatibility-with-postprocess">
    <h2>Backwards compatibility with <code>postProcess</code></h2>



<div class="section">
<h3 id="rastertomatch-and-studyarea-"><code>rasterToMatch</code> and <code>studyArea</code>:<a class="anchor" aria-label="anchor" href="#rastertomatch-and-studyarea-"></a></h3>


<p>If these are supplied, <code>postProcessTo</code> will use them instead
of <code>to</code>. If only <code>rasterToMatch</code> is supplied, it will be assigned to
<code>to</code>. If only <code>studyArea</code> is supplied, it will be used for <code>cropTo</code>
and <code>maskTo</code>; it will only be used for <code>projectTo</code> if <code>useSAcrs = TRUE</code>.
If both <code>rasterToMatch</code> and <code>studyArea</code> are supplied,
<code>studyArea</code> will only be applied to <code>maskTo</code> (unless <code>maskWithRTM = TRUE</code>),
and, optionally, to <code>projectTo</code> (if <code>useSAcrs = TRUE</code>); everything else
will be from <code>rasterToMatch</code>.</p>
</div>

<div class="section">
<h3 id="targetcrs-filename-usesacrs-maskwithrtm-"><code>targetCRS</code>, <code>filename2</code>, <code>useSAcrs</code>, <code>maskWithRTM</code>:<a class="anchor" aria-label="anchor" href="#targetcrs-filename-usesacrs-maskwithrtm-"></a></h3>


<p><code>targetCRS</code> if supplied will be assigned to <code>projectTo</code>. <code>filename2</code> will
be assigned to <code>writeTo</code>. If <code>useSAcrs</code> is set, then the <code>studyArea</code>
will be assigned to <code>projectTo</code>. If <code>maskWithRTM</code> is used, then the
<code>rasterToMath</code> will be assigned to <code>maskTo</code>. All of these will override
any existing values for these arguments.</p>
</div>

<p>See also <code><a href="postProcess.html">postProcess()</a></code> documentation section on
<em>Backwards compatibility with <code>rasterToMatch</code> and/or <code>studyArea</code></em> for further
detail.</p>
    </div>
    <div id="cropping">
    <h2>Cropping</h2>


<p>If <code>cropTo</code> is not <code>NA</code>, <code>postProcessTo</code> does cropping twice, both the first and last steps.
It does it first for speed, as cropping is a very fast algorithm. This will quickly remove
a bunch of pixels that are not necessary. But, to not create bias, this first crop is padded
by  <code>2 * res(from)[1]</code>), so that edge cells still have a complete set of neighbours.
The second crop is at the end, after projecting and masking. After the projection step,
the crop is no longer tight. Under some conditions, masking will effectively mask and crop in
one step, but under some conditions, this is not true, and the mask leaves padded NAs out to
the extent of the <code>from</code> (as it is after crop, project, mask). Thus the second
crop removes all NA cells so they are tight to the mask.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code>maskTo()</code>, <code>cropTo()</code>, <code>projectTo()</code>, <code>writeTo()</code>, and <code><a href="fixErrorsIn.html">fixErrorsIn()</a></code>.
Also the functions that
call <code>sf::gdal_utils(...)</code> directly: <code><a href="gdalwarpFns.html">gdalProject()</a></code>, <code><a href="gdalwarpFns.html">gdalResample()</a></code>, <code><a href="gdalwarpFns.html">gdalMask()</a></code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># prepare dummy data -- 3 SpatRasters, 2 SpatVectors</span></span></span>
<span class="r-in"><span><span class="co"># need 2 SpatRaster</span></span></span>
<span class="r-in"><span><span class="va">rf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"ex/elev.tif"</span>, package <span class="op">=</span> <span class="st">"terra"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">elev1</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">rf</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#'</span></span></span>
<span class="r-in"><span><span class="va">ras2</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/deepcopy.html" class="external-link">deepcopy</a></span><span class="op">(</span><span class="va">elev1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ras2</span><span class="op">[</span><span class="va">ras2</span> <span class="op">&gt;</span> <span class="fl">200</span> <span class="op">&amp;</span> <span class="va">ras2</span> <span class="op">&lt;</span> <span class="fl">300</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA_integer_</span></span></span>
<span class="r-in"><span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">elev1</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1L</span>, <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">ncell</a></span><span class="op">(</span><span class="va">ras2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#'</span></span></span>
<span class="r-in"><span><span class="co"># a polygon vector</span></span></span>
<span class="r-in"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"ex/lux.shp"</span>, package <span class="op">=</span> <span class="st">"terra"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">vOrig</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">v</span> <span class="op">&lt;-</span> <span class="va">vOrig</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="op">]</span></span></span>
<span class="r-in"><span><span class="co">#'</span></span></span>
<span class="r-in"><span><span class="va">utm</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="st">"epsg:23028"</span><span class="op">)</span> <span class="co"># $wkt</span></span></span>
<span class="r-in"><span><span class="va">vInUTM</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/project.html" class="external-link">project</a></span><span class="op">(</span><span class="va">vOrig</span>, <span class="va">utm</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">vAsRasInLongLat</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">vOrig</span>, resolution <span class="op">=</span> <span class="fl">0.008333333</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">res100</span> <span class="op">&lt;-</span> <span class="fl">100</span></span></span>
<span class="r-in"><span><span class="va">rInUTM</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">vInUTM</span>, resolution <span class="op">=</span> <span class="va">res100</span>, vals <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># crop, reproject, mask, crop a raster with a vector in a different projection</span></span></span>
<span class="r-in"><span><span class="co">#  --&gt; gives message about not enough information</span></span></span>
<span class="r-in"><span><span class="va">t1</span> <span class="op">&lt;-</span> <span class="fu">postProcessTo</span><span class="op">(</span><span class="va">elev1</span>, to <span class="op">=</span> <span class="va">vInUTM</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">Running `postProcessTo`</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">cropping...</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">projecting...</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">projectTo is a Vector dataset, which does not define all metadata required.</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  <span style="color: #00BBBB;">Using the origin and extent from `ext(from)` in the projection from</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>    <span style="color: #00BBBB;">`crs(projectTo)`.</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  <span style="color: #00BBBB;">If this is not correct, create a template gridded object and pass that to</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>    <span style="color: #00BBBB;">`projectTo`...</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">done! took:  0.032 secs</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">masking...</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">done! took:  0.0109 secs</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">cropping...</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">done! took:  0.0208 secs</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">postProcessTo done! took:  0.136 secs</span></span>
<span class="r-in"><span><span class="co"># crop, reproject, mask a raster to a different projection, then mask</span></span></span>
<span class="r-in"><span><span class="va">t2a</span> <span class="op">&lt;-</span> <span class="fu">postProcessTo</span><span class="op">(</span><span class="va">elev1</span>, to <span class="op">=</span> <span class="va">vAsRasInLongLat</span>, maskTo <span class="op">=</span> <span class="va">vInUTM</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">Running `postProcessTo`</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Try setting options('reproducible.gdalwarp' = TRUE) to use a different, possibly faster, algorithm</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">cropping...</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">projecting...</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">done! took:  0.0336 secs</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">masking...</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">done! took:  0.011 secs</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">cropping...</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">done! took:  0.0111 secs</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">postProcessTo done! took:  0.102 secs</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># using gdal directly --&gt; slightly different mask</span></span></span>
<span class="r-in"><span><span class="va">opts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>reproducible.gdalwarp <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">t2b</span> <span class="op">&lt;-</span> <span class="fu">postProcessTo</span><span class="op">(</span><span class="va">elev1</span>, to <span class="op">=</span> <span class="va">vAsRasInLongLat</span>, maskTo <span class="op">=</span> <span class="va">vInUTM</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">Running `postProcessTo`</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">using sf::gdal_utils('warp') because options("reproducible.gdalwarp" = TRUE) ...</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">running gdalProject ...</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">done! took:  0.0204 secs</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">running gdalResample ...</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">done! took:  0.0166 secs</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">running gdalMask ...</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">done! took:  0.0397 secs</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">postProcessTo done! took:  0.0801 secs</span></span>
<span class="r-in"><span><span class="va">t3b</span> <span class="op">&lt;-</span> <span class="fu">postProcessTo</span><span class="op">(</span><span class="va">elev1</span>, to <span class="op">=</span> <span class="va">rInUTM</span>, maskTo <span class="op">=</span> <span class="va">vInUTM</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">Running `postProcessTo`</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">using sf::gdal_utils('warp') because options("reproducible.gdalwarp" = TRUE) ...</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">running gdalProject ...</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">done! took:  0.0465 secs</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">running gdalResample ...</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">done! took:  0.0299 secs</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">running gdalMask ...</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">done! took:  0.165 secs</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">postProcessTo done! took:  0.245 secs</span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="va">opts</span><span class="op">)</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Eliot J B McIntire, Alex M Chubaty.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer></div>






  </body></html>

