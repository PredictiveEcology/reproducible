<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Transform a GIS dataset so it has the properties (extent, projection, mask) of another — postProcessTerra • reproducible</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Transform a GIS dataset so it has the properties (extent, projection, mask) of another — postProcessTerra"><meta property="og:description" content='This function provides a single step to achieve the GIS operations "crop", "project",
"mask" and possibly "write". It uses primarily the terra package internally
(with some minor functions from sf and raster)
in an attempt to be as efficient as possible.
For this function, Gridded means a Raster* class object from raster or
a SpatRaster class object from terra.
Vector means a Spatial* class object from sp, a sf class object
from sf, or a SpatVector class object from terra.'><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-58633549-5"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-58633549-5');
</script></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">reproducible</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.2.10</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/Cache-using-postgresql.html">Using alternate database backends for Cache</a>
    </li>
    <li>
      <a href="../articles/Intro-to-Cache.html">Introduction to Cache</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/PredictiveEcology/reproducible/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Transform a GIS dataset so it has the properties (extent, projection, mask) of another</h1>
    <small class="dont-index">Source: <a href="https://github.com/PredictiveEcology/reproducible/blob/HEAD/R/postProcessTerra.R" class="external-link"><code>R/postProcessTerra.R</code></a></small>
    <div class="hidden name"><code>postProcessTerra.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function provides a single step to achieve the GIS operations "crop", "project",
"mask" and possibly "write". It uses primarily the <code>terra</code> package internally
(with some minor functions from <code>sf</code> and <code>raster</code>)
in an attempt to be as efficient as possible.
For this function, Gridded means a <code>Raster*</code> class object from <code>raster</code> or
a <code>SpatRaster</code> class object from <code>terra</code>.
Vector means a <code>Spatial*</code> class object from <code>sp</code>, a <code>sf</code> class object
from <code>sf</code>, or a <code>SpatVector</code> class object from <code>terra</code>.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">postProcessTerra</span><span class="op">(</span></span>
<span>  <span class="va">from</span>,</span>
<span>  <span class="va">to</span>,</span>
<span>  cropTo <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  projectTo <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  maskTo <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  writeTo <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  method <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  datatype <span class="op">=</span> <span class="st">"FLT4S"</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">cropTo</span><span class="op">(</span><span class="va">from</span>, cropTo <span class="op">=</span> <span class="cn">NULL</span>, needBuffer <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>from</dt>
<dd><p>A Gridded or Vector dataset on which to do one or more of:
crop, project, mask, and write</p></dd>


<dt>to</dt>
<dd><p>A Gridded or Vector dataset which is the object
whose metadata will be the target for cropping, projecting, and masking of <code>from</code>.</p></dd>


<dt>cropTo</dt>
<dd><p>A Vector dataset</p></dd>


<dt>projectTo</dt>
<dd><p>Optional Gridded or Vector dataset, or <code>crs</code> object (e.g., sf::st_crs).
If Gridded it will supply
the <code>crs</code>, <code>extent</code>, <code>res</code>, and <code>origin</code>
to project the <code>from</code> to. If Vector, it will provide the <code>crs</code> only.
The resolution and extent will be taken from <code>res(from)</code> (i.e. <code>ncol(from)*nrow(from)</code>).
If a Vector, the extent of the <code>projectTo</code> is not used (unless it is also passed to <code>cropTo</code>.
To omit projecting, set this to <code>NA</code>.
If supplied, this will override <code>to</code>
for the projecting step. Defaults to <code>NULL</code>, which means use <code>to</code></p></dd>


<dt>maskTo</dt>
<dd><p>Optional Gridded or Vector dataset which,
if supplied, will supply the extent with which to mask <code>from</code>. If Gridded,
it will mask with the <code>NA</code> values on the <code>maskTo</code>; if Vector, it will
mask on the <code>terra::aggregate(maskTo)</code>. To omit
masking completely, set this to <code>NA</code>. If supplied,
this will override <code>to</code> for the masking step.
Defaults to <code>NULL</code>, which means use <code>to</code></p></dd>


<dt>writeTo</dt>
<dd><p>Optional character string of a filename to use `writeRaster` to save the final
object. Default is <code>NULL</code>, which means there is no `writeRaster`</p></dd>


<dt>method</dt>
<dd><p>Used if <code>projectTo</code> is not <code>NULL</code>, and is the method used for
interpolation. See <code><a href="https://rdrr.io/pkg/terra/man/project.html" class="external-link">terra::project</a></code>. Defaults to <code>"bilinear"</code></p></dd>


<dt>datatype</dt>
<dd><p>A character string, used if <code>writeTo</code> is not <code>NULL</code>. See <code><a href="https://rdrr.io/pkg/terra/man/writeRaster.html" class="external-link">raster::writeRaster</a></code></p></dd>


<dt>overwrite</dt>
<dd><p>Logical. Used if <code>writeTo</code> is not <code>NULL</code></p></dd>


<dt>...</dt>
<dd><p>Currently can be either <code>rasterToMatch</code>, <code>studyArea</code>, <code>filename2</code>,
<code>useSAcrs</code>, or <code>targetCRS</code> to allow backwards
compatibility with <code>postProcess</code>. See section below for details.</p></dd>


<dt>needBuffer</dt>
<dd><p>Logical. Defaults to <code>TRUE</code>, meaning nothing is done out
of the ordinary. If <code>TRUE</code>, then a buffer around the cropTo, so that if a reprojection
has to happen on the `cropTo` prior to using it as a crop layer, then a buffer
of 1.5 * res(cropTo) will occur prior, so that no edges are cut off.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>An object of the same class as <code>from</code>, but potentially cropped, projected, masked,
and written to disk.</p>
    </div>
    <div id="use-cases">
    <h2>Use Cases</h2>
    


<p>The table below shows what will result from passing different classes to <code>from</code>
and <code>to</code>:</p>
<table class="table table"><tr><td><code>from</code></td><td><code>to</code></td><td><code>from</code> will have:</td></tr><tr><td><code>Gridded</code></td><td><code>Gridded</code></td><td>the extent, projection, origin, resolution and
                        masking where there are <code>NA</code> from the to</td></tr><tr><td><code>Gridded</code></td><td><code>Vector</code></td><td>the projection, origin, and mask from <code>to</code>, and extent will
                       be a round number of pixels that fit within the extent
                       of <code>to</code>. Resolution will be the same as <code>from</code></td></tr><tr><td><code>Vector</code></td><td><code>Vector</code></td><td>the projection, origin, extent and mask from <code>to</code></td></tr></table><p>If one or more of the <code>*To</code> arguments are supplied, these will
override individual components of <code>to</code>. If <code>to</code> is omitted or <code>NULL</code>,
then only the <code>*To</code> arguments that are used will be performed. In all cases,
setting a <code>*To</code> argument to <code>NA</code> will prevent that step from happening.</p>
    </div>
    <div id="backwards-compatibility-with-postprocess">
    <h2>Backwards compatibility with <code>postProcess</code></h2>
    


<div class="section">
<h3 id="rastertomatch-and-studyarea-"><code>rasterToMatch</code> and <code>studyArea</code>:<a class="anchor" aria-label="anchor" href="#rastertomatch-and-studyarea-"></a></h3>


<p>If these are supplied, <code>postProcessTerra</code> will use them instead
  of <code>to</code>. If only <code>rasterToMatch</code> is supplied, it will be assigned to
  <code>to</code>. If only <code>studyArea</code> is supplied, it will be used for <code>cropTo</code>
  and <code>maskTo</code>; it will only be used for <code>projectTo</code> if <code>useSAcrs = TRUE</code>.
  If both <code>rasterToMatch</code> and <code>studyArea</code> are supplied,
  <code>studyArea</code> will only be applied to <code>maskTo</code> (and optionally <code>projectTo</code> if
  <code>useSAcrs = TRUE</code>); everything else will be from <code>rasterToMatch</code>.</p>
</div>

<div class="section">
<h3 id="targetcrs-filename-usesacrs-"><code>targetCRS</code>, <code>filename2</code>, <code>useSAcrs</code>:<a class="anchor" aria-label="anchor" href="#targetcrs-filename-usesacrs-"></a></h3>


<p><code>targetCRS</code> if supplied will be assigned to <code>projectTo</code>. <code>filename2</code> will
  be assigned to <code>writeTo</code>. If <code>useSAcrs</code> is set, then the <code>studyArea</code>
  will be assigned to <code>projectTo</code>. All of these will override any existing values
  for these arguments.</p>
</div>

    </div>
    <div id="cropping">
    <h2>Cropping</h2>
    

<p>If `cropTo` is not `NA`, postProcessTerra does cropping twice, both the first and last steps.
It does it first for speed, as cropping is a very fast algorithm. This will quickly remove
a bunch of pixels that are not necessary. But, to not create bias, this first crop is padded
by  <code>2 * res(from)[1]</code>), so that edge cells still have a complete set of neighbours.
The second crop is at the end, after projecting and masking. After the projection step,
the crop is no longer tight. Under some conditions, masking will effectively mask and crop in
on step, but under some conditions, this is not true, and the mask leaves padded NAs out to
the extent of the <code>from</code> (as it is after crop, project, mask). Thus the second
crop removes all NA cells so they are tight to the mask.</p>
    </div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Eliot J B McIntire, Alex M Chubaty.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer></div>

  


  

  </body></html>

