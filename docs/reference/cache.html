<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Cache method that accommodates environments, S4 methods, Rasters, &amp; nested caching — Cache • reproducible</title>

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Cache method that accommodates environments, S4 methods, Rasters, &amp; nested caching — Cache" />

<meta property="og:description" content="Still experimental and may change. This form cannot pass any arguments to
]codeCache, such as cacheRepo, thus it is of limited utility. However,
it is a clean alternative for simple cases." />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-58633549-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-58633549-5');
</script>

  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">reproducible</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.8</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/Intro-to-Cache.html">Introduction to Cache</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/PredictiveEcology/reproducible">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Cache method that accommodates environments, S4 methods, Rasters, &amp; nested caching</h1>
    <small class="dont-index">Source: <a href='https://github.com/PredictiveEcology/reproducible/blob/master/R/cache.R'><code>R/cache.R</code></a>, <a href='https://github.com/PredictiveEcology/reproducible/blob/master/R/pipe.R'><code>R/pipe.R</code></a></small>
    <div class="hidden name"><code>cache.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>Still experimental and may change. This form cannot pass any arguments to
]codeCache, such as <code>cacheRepo</code>, thus it is of limited utility. However,
it is a clean alternative for simple cases.</p>
    
    </div>

    <pre class="usage"><span class='fu'>Cache</span>(<span class='no'>FUN</span>, <span class='no'>...</span>, <span class='kw'>notOlderThan</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>.objects</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>outputObjects</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>algo</span> <span class='kw'>=</span> <span class='st'>"xxhash64"</span>, <span class='kw'>cacheRepo</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>length</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/options'>getOption</a></span>(<span class='st'>"reproducible.length"</span>, <span class='fl'>Inf</span>),
  <span class='no'>compareRasterFileLength</span>, <span class='kw'>userTags</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(), <span class='no'>digestPathContent</span>,
  <span class='kw'>omitArgs</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>classOptions</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(), <span class='kw'>debugCache</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/character'>character</a></span>(),
  <span class='kw'>sideEffect</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>makeCopy</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>quick</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/options'>getOption</a></span>(<span class='st'>"reproducible.quick"</span>, <span class='fl'>FALSE</span>),
  <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/options'>getOption</a></span>(<span class='st'>"reproducible.verbose"</span>, <span class='fl'>0</span>), <span class='kw'>cacheId</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>useCache</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/options'>getOption</a></span>(<span class='st'>"reproducible.useCache"</span>, <span class='fl'>TRUE</span>),
  <span class='kw'>showSimilar</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/options'>getOption</a></span>(<span class='st'>"reproducible.showSimilar"</span>, <span class='fl'>FALSE</span>))

<span class='co'># S4 method for ANY</span>
<span class='fu'>Cache</span>(<span class='no'>FUN</span>, <span class='no'>...</span>, <span class='kw'>notOlderThan</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>.objects</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>outputObjects</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>algo</span> <span class='kw'>=</span> <span class='st'>"xxhash64"</span>, <span class='kw'>cacheRepo</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>length</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/options'>getOption</a></span>(<span class='st'>"reproducible.length"</span>, <span class='fl'>Inf</span>),
  <span class='no'>compareRasterFileLength</span>, <span class='kw'>userTags</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(), <span class='no'>digestPathContent</span>,
  <span class='kw'>omitArgs</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>classOptions</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(), <span class='kw'>debugCache</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/character'>character</a></span>(),
  <span class='kw'>sideEffect</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>makeCopy</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>quick</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/options'>getOption</a></span>(<span class='st'>"reproducible.quick"</span>, <span class='fl'>FALSE</span>),
  <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/options'>getOption</a></span>(<span class='st'>"reproducible.verbose"</span>, <span class='fl'>0</span>), <span class='kw'>cacheId</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>useCache</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/options'>getOption</a></span>(<span class='st'>"reproducible.useCache"</span>, <span class='fl'>TRUE</span>),
  <span class='kw'>showSimilar</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/options'>getOption</a></span>(<span class='st'>"reproducible.showSimilar"</span>, <span class='fl'>FALSE</span>))

<span class='no'>lhs</span> <span class='kw'>%&lt;%</span> <span class='no'>rhs</span></pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>FUN</th>
      <td><p>Either a function or an unevaluated function call (e.g., using
<code>quote</code>.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Arguments of <code>FUN</code> function .</p></td>
    </tr>
    <tr>
      <th>notOlderThan</th>
      <td><p>load an artifact from the database only if it was created after notOlderThan.</p></td>
    </tr>
    <tr>
      <th>.objects</th>
      <td><p>Character vector of objects to be digested. This is only applicable
if there is a list, environment (or similar) named objects
within it. Only this/these objects will be considered for caching,
i.e., only use a subset of
the list, environment or similar objects.</p></td>
    </tr>
    <tr>
      <th>outputObjects</th>
      <td><p>Optional character vector indicating which objects to
return. This is only relevant for list, environment (or similar) objects</p></td>
    </tr>
    <tr>
      <th>algo</th>
      <td><p>The algorithms to be used; currently available choices are
    <code>md5</code>, which is also the default, <code>sha1</code>, <code>crc32</code>,
    <code>sha256</code>, <code>sha512</code>, <code>xxhash32</code>, <code>xxhash64</code> and
    <code>murmur32</code>.</p></td>
    </tr>
    <tr>
      <th>cacheRepo</th>
      <td><p>A repository used for storing cached objects.
This is optional if <code>Cache</code> is used inside a SpaDES module.</p></td>
    </tr>
    <tr>
      <th>length</th>
      <td><p>Numeric. If the element passed to Cache is a <code>Path</code> class
object (from e.g., <code><a href='Path-class.html'>asPath(filename)</a></code>) or it is a <code>Raster</code> with
file-backing, then this will be
passed to <code><a href='https://www.rdocumentation.org/packages/digest/topics/digest'>digest::digest</a></code>, essentially limiting the number of bytes
to digest (for speed). This will only be used if <code>quick = FALSE</code>.
Default is <code><a href='https://www.rdocumentation.org/packages/base/topics/options'>getOption("reproducible.length")</a></code>,
which is set to <code>Inf</code>.</p></td>
    </tr>
    <tr>
      <th>compareRasterFileLength</th>
      <td><p>Being deprecated; use <code>length</code>.</p></td>
    </tr>
    <tr>
      <th>userTags</th>
      <td><p>A character vector with Tags. These Tags will be added to the repository along with the artifact.</p></td>
    </tr>
    <tr>
      <th>digestPathContent</th>
      <td><p>Being deprecated. Use <code>quick</code>.</p></td>
    </tr>
    <tr>
      <th>omitArgs</th>
      <td><p>Optional character string of arguments in the FUN to omit from the digest.</p></td>
    </tr>
    <tr>
      <th>classOptions</th>
      <td><p>Optional list. This will pass into <code>.robustDigest</code> for
specific classes. Should be options that the <code>.robustDigest</code> knows what
to do with.</p></td>
    </tr>
    <tr>
      <th>debugCache</th>
      <td><p>Character or Logical. Either <code>"complete"</code> or <code>"quick"</code> (uses
partial matching, so "c" or "q" work). <code>TRUE</code> is
equivalent to <code>"complete"</code>.
If <code>"complete"</code>, then the returned object from the Cache
function will have two attributes, <code>debugCache1</code> and <code>debugCache2</code>,
which are the entire <code><a href='https://www.rdocumentation.org/packages/base/topics/list'>list(...)</a></code> and that same object, but after all
<code>.robustDigest</code> calls, at the moment that it is digested using
<code>digest</code>, respectively. This <code><a href='https://www.rdocumentation.org/packages/base/topics/attr'>attr(mySimOut, "debugCache2")</a></code>
can then be compared to a subsequent call and individual items within
the object <code><a href='https://www.rdocumentation.org/packages/base/topics/attr'>attr(mySimOut, "debugCache1")</a></code> can be compared.
If <code>"quick"</code>, then it will return the same two objects directly,
without evalutating the <code>FUN(...)</code>.</p></td>
    </tr>
    <tr>
      <th>sideEffect</th>
      <td><p>Logical or path. Determines where the function will look for
new files following function completion. See Details.
<em>NOTE: this argument is experimental and may change in future releases.</em></p></td>
    </tr>
    <tr>
      <th>makeCopy</th>
      <td><p>Logical. If <code>sideEffect = TRUE</code>, and <code>makeCopy = TRUE</code>,
a copy of the downloaded files will be made and stored in the <code>cacheRepo</code>
to speed up subsequent file recovery in the case where the original copy
of the downloaded files are corrupted or missing. Currently only works when
set to <code>TRUE</code> during the first run of <code>Cache</code>. Default is <code>FALSE</code>.
<em>NOTE: this argument is experimental and may change in future releases.</em></p></td>
    </tr>
    <tr>
      <th>quick</th>
      <td><p>Logical. If <code>TRUE</code>,
little or no disk-based information will be assessed, i.e., mostly its
memory content. This is relevant for objects of class <code>character</code>,
<code>Path</code> and <code>Raster</code> currently. For class <code>character</code>, it is ambiguous
whether this represents a character string or a vector of file paths. The function
will assess if it is a path to a file or directory first. If not, it will treat
the object as a character string. If it is known that character strings should
not be treated as paths, then <code>quick = TRUE</code> will be much faster, with no loss
of information. If it is file or directory, then it will digest the file content,
or <code><a href='https://www.rdocumentation.org/packages/base/topics/basename'>basename(object)</a></code>. For class <code>Path</code> objects, the file's metadata
(i.e., filename and file size)
will be hashed instead of the file contents if <code>quick = TRUE</code>.
If set to <code>FALSE</code> (default),
the contents of the file(s) are hashed.
If <code>quick = TRUE</code>, <code>length</code> is ignored. <code>Raster</code> objects are treated
as paths, if they are file-backed.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>Numeric, with 0 being off, 1 being a little, 2 being more verbose etc.
Above 1 will output much more information about the internals of
Caching, which may help diagnose Caching challenges.</p></td>
    </tr>
    <tr>
      <th>cacheId</th>
      <td><p>Character string. If passed, this will override the calculated hash
of the inputs, and return the result from this cacheId in the cacheRepo.
Setting this is equivalent to manually saving the output of this function, i.e.,
the object will be on disk, and will be recovered in subsequent
This may help in some particularly finicky situations
where Cache is not correctly detecting unchanged inputs. This will guarantee
the object will be identical each time; this may be useful in operational code.</p></td>
    </tr>
    <tr>
      <th>useCache</th>
      <td><p>Logical or <code>"overwrite"</code> or <code>"devMode"</code>. See details.</p></td>
    </tr>
    <tr>
      <th>showSimilar</th>
      <td><p>A logical or numeric. Useful for debugging.
If <code>TRUE</code> or <code>1</code>, then if the Cache
does not find an identical archive in the cacheRepo, it will report (via message)
the next most similar archive, and indicate which argument(s) is/are different.
If a number larger than <code>1</code>, then it will report the N most similar archived
objects.</p></td>
    </tr>
    <tr>
      <th>lhs</th>
      <td><p>A name to assign to.</p></td>
    </tr>
    <tr>
      <th>rhs</th>
      <td><p>A function call</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>As with <code><a href='https://www.rdocumentation.org/packages/archivist/topics/cache'>cache</a></code>, returns the value of the
function call or the cached version (i.e., the result from a previous call
to this same cached function with identical arguments).</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Caching R objects using <code><a href='https://www.rdocumentation.org/packages/archivist/topics/cache'>cache</a></code> has five important limitations:</p><ol>
<li><p>the <code>archivist</code> package detects different environments as different;</p></li>
<li><p>it also does not detect S4 methods correctly due to method inheritance;</p></li>
<li><p>it does not detect objects that have file-base storage of information
        (specifically <code><a href='https://www.rdocumentation.org/packages/raster/topics/Raster-classes'>RasterLayer-class</a></code> objects);</p></li>
<li><p>the default hashing algorithm is relatively slow.</p></li>
<li><p>heavily nested function calls may want Cache arguments to propagate through</p></li>
</ol><p>This version of the <code>Cache</code> function accommodates those four special,
though quite common, cases by:</p><ol>
<li><p>converting any environments into list equivalents;</p></li>
<li><p>identifying the dispatched S4 method (including those made through
        inheritance) before hashing so the correct method is being cached;</p></li>
<li><p>by hashing the linked file, rather than the Raster object.
        Currently, only file-backed <code>Raster*</code> objects are digested
        (e.g., not <code>ff</code> objects, or any other R object where the data
        are on disk instead of in RAM);</p></li>
<li><p>Uses <code><a href='https://www.rdocumentation.org/packages/digest/topics/digest'>digest</a></code> (formerly fastdigest, which does
        not translate between operating systems).
        This is used for file-backed objects as well.</p></li>
<li><p>Cache will save arguments passed by user in a hidden environment. Any
        nested Cache functions will use arguments in this order 1) actual arguments
        passed at each Cache call, 2) any inherited arguments from an outer Cache
        call, 3) the default values of the Cache function. See section on <em>Nested
        Caching</em>.</p></li>
</ol>
    <p>If <code>Cache</code> is called within a SpaDES module, then the cached entry will automatically
get 3 extra <code>userTags</code>: <code>eventTime</code>, <code>eventType</code>, and <code>moduleName</code>.
These can then be used in <code>clearCache</code> to selectively remove cached objects
by <code>eventTime</code>, <code>eventType</code> or <code>moduleName</code>.</p>
<p><code>Cache</code> will add a tag to the artifact in the database called <code>accessed</code>,
which will assign the time that it was accessed, either read or write.
That way, artifacts can be shown (using <code>showCache</code>) or removed (using
<code>clearCache</code>) selectively, based on their access dates, rather than only
by their creation dates. See example in <code><a href='viewCache.html'>clearCache</a></code>.
<code>Cache</code> (uppercase C) is used here so that it is not confused with, and does
not mask, the <code><a href='https://www.rdocumentation.org/packages/archivist/topics/cache'>archivist::cache</a></code> function.</p>
    
    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p>As indicated above, several objects require pre-treatment before
caching will work as expected. The function <code>.robustDigest</code> accommodates this.
It is an S4 generic, meaning that developers can produce their own methods for
different classes of objects. Currently, there are methods for several types
of classes. See <code><a href='robustDigest.html'>.robustDigest</a></code>.</p>
<p>See <code><a href='robustDigest.html'>.robustDigest</a></code> for other specifics for other classes.</p>
    
    <h2 class="hasAnchor" id="nested-caching"><a class="anchor" href="#nested-caching"></a>Nested Caching</h2>

    
    <p>Commonly, Caching is nested, i.e., an outer function is wrapped in a <code>Cache</code>
function call, and one or more inner functions are also wrapped in a <code>Cache</code>
function call. A user <em>can</em> always specify arguments in every Cache function
call, but this can get tedious and can be prone to errors. The normal way that
<em>R</em> handles arguments is it takes the user passed arguments if any, and
default arguments for all those that have no user passed arguments. We have inserted
a middle step. The order or precedence for any given <code>Cache</code> function call is
1. user arguments, 2. inherited arguments, 3. default arguments. At this time,
the top level <code>Cache</code> arguments will propagate to all inner functions unless
each individual <code>Cache</code> call has other arguments specified, i.e., "middle"
nested <code>Cache</code> function calls don't propagate their arguments to further "inner"
<code>Cache</code> function calls.  See example.</p>
<p><code>userTags</code> is unique of all arguments: its values will be appended to the
inherited <code>userTags</code>.</p>
    
    <h2 class="hasAnchor" id="caching-speed"><a class="anchor" href="#caching-speed"></a>Caching Speed</h2>

    
    <p>Caching speed may become a critical aspect of a final product. For example,
if the final product is a shiny app, rerunning the entire project may need
to take less then a few seconds at most. There are 3 arguments that affect
Cache speed: <code>quick</code>, <code>length</code>, and
<code>algo</code>. <code>quick</code> is passed to <code>.robustDigest</code>, which currently
only affects <code>Path</code> and <code>Raster*</code> class objects. In both cases, <code>quick</code>
means that little or no disk-based information will be assessed.</p>
    
    <h2 class="hasAnchor" id="filepaths"><a class="anchor" href="#filepaths"></a>Filepaths</h2>

    
    <p>If a function has a path argument, there is some ambiguity about what should be
done. Possibilities include:</p><ol>
<li><p>hash the string as is (this will be very system specific, meaning a
        <code>Cache</code> call will not work if copied between systems or directories);</p></li>
<li><p>hash the <code><a href='https://www.rdocumentation.org/packages/base/topics/basename'>basename(path)</a></code>;</p></li>
<li><p>hash the contents of the file.</p></li>
</ol><p>If paths are passed in as is (i.e,. character string), the result will not be predictable.
Instead, one should use the wrapper function <code><a href='Path-class.html'>asPath(path)</a></code>, which sets the
class of the string to a <code>Path</code>, and one should decide whether one wants
to digest the content of the file (using <code>quick = FALSE</code>),
or just the filename (<code>(quick = TRUE)</code>). See examples.</p>
    
    <h2 class="hasAnchor" id="stochasticity"><a class="anchor" href="#stochasticity"></a>Stochasticity</h2>

    
    <p>In general, it is expected that caching will only be used when stochasticity
is not relevant, or if a user has achieved sufficient stochasticity (e.g., via
sufficient number of calls to <code>experiment</code>) such that no new explorations
of stochastic outcomes are required. It will also be very useful in a
reproducible workflow.</p>
    
    <h2 class="hasAnchor" id="usecache"><a class="anchor" href="#usecache"></a>useCache</h2>

    
    <p>If <code>FALSE</code>, then the entire Caching mechanism is bypassed and the
function is evaluated as if it was not being Cached. Default is
<code><a href='https://www.rdocumentation.org/packages/base/topics/options'>getOption("reproducible.useCache")</a></code>), which is <code>TRUE</code> by default,
meaning use the Cache mechanism. This may be useful to turn all Caching on or
off in very complex scripts and nested functions.</p>
<p>If <code>"overwrite"</code>
(which can be set with <code><a href='https://www.rdocumentation.org/packages/base/topics/options'>options("reproducible.useCache" =
"overwrite")</a></code>), then the function invoke the caching mechanism but will purge
any entry that is matched, and it will be replaced with the results of the
current call.</p>
<p>If <code>"devMode"</code>: The point of this mode is to facilitate using the Cache when
functions and datasets are continually in flux, and old Cache entries are
likely stale very often. In `devMode`, the cache mechanism will work as
normal if the Cache call is the first time for a function OR if it
successfully finds a copy in the cache based on the normal Cache mechanism.
It *differs* from the normal Cache if the Cache call does *not* find a copy
in the `cacheRepo`, but it does find an entry that matches based on
`userTags`. In this case, it will delete the old entry in the `cacheRepo`
(identified based on matching `userTags`), then continue with normal `Cache`.
For this to work correctly, `userTags` must be unique for each function call.
This should be used with caution as it is still experimental. Currently, if
<code>userTags</code> are not unique to a single entry in the cacheRepo, it will
default to the behaviour of <code>useCache = TRUE</code> with a message. This means
that <code>"devMode"</code> is most useful if used from the start of a project.</p>
    
    <h2 class="hasAnchor" id="sideeffect"><a class="anchor" href="#sideeffect"></a><code>sideEffect</code></h2>

    
    <p>If <code>sideEffect</code> is not <code>FALSE</code>, then metadata about any files that
added to <code>sideEffect</code> will be added as an attribute to the cached copy.
Subsequent calls to this function
       will assess for the presence of the new files in the <code>sideEffect</code> location.
       If the files are identical (<code>quick = FALSE</code>) or their file size is
       identical (<code>quick = TRUE</code>), then the cached copy of the function will
       be returned (and no files changed). If there are missing or incorrect files,
       then the function will re-run. This will accommodate the situation where the
       function call is identical, but somehow the side effect files were modified.
       If <code>sideEffect</code> is logical, then the function will check the
       <code>cacheRepo</code>; if it is a path, then it will check the path. The function will
       assess whether the files to be downloaded are found locally
       prior to download. If it fails the local test, then it will try to recover from a
       local copy if (<code>makeCopy</code> had been set to <code>TRUE</code> the first time
       the function was run. Currently, local recovery will only work if<code>makeCOpy</code> was
       set to <code>TRUE</code> the first time <code>Cache</code>
       was run). Default is <code>FALSE</code>.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='https://www.rdocumentation.org/packages/archivist/topics/cache'>cache</a></code>, <code><a href='robustDigest.html'>.robustDigest</a></code></p></div>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='no'>tmpDir</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/file.path'>file.path</a></span>(<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/tempfile'>tempdir</a></span>())

<span class='co'># Basic use</span>
<span class='no'>ranNumsA</span> <span class='kw'>&lt;-</span> <span class='fu'>Cache</span>(<span class='no'>rnorm</span>, <span class='fl'>10</span>, <span class='fl'>16</span>, <span class='kw'>cacheRepo</span> <span class='kw'>=</span> <span class='no'>tmpDir</span>)

<span class='co'># All same</span>
<span class='no'>ranNumsB</span> <span class='kw'>&lt;-</span> <span class='fu'>Cache</span>(<span class='no'>rnorm</span>, <span class='fl'>10</span>, <span class='fl'>16</span>, <span class='kw'>cacheRepo</span> <span class='kw'>=</span> <span class='no'>tmpDir</span>) <span class='co'># recovers cached copy</span></div><div class='output co'>#&gt; <span class='message'><span style='color: #0000BB;'>  loading cached result from previous rnorm call, adding to memoised copy</span><span></span></div><div class='input'><span class='no'>ranNumsC</span> <span class='kw'>&lt;-</span> <span class='fu'>Cache</span>(<span class='kw'>cacheRepo</span> <span class='kw'>=</span> <span class='no'>tmpDir</span>) <span class='kw'>%C%</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/stats/topics/Normal'>rnorm</a></span>(<span class='fl'>10</span>, <span class='fl'>16</span>)  <span class='co'># recovers cached copy</span></div><div class='output co'>#&gt; <span class='message'></span><span style='color: #0000BB;'>  loading memoised result from previous 'rnorm' pipe sequence call.</span><span></span></div><div class='input'><span class='no'>ranNumsD</span> <span class='kw'>&lt;-</span> <span class='fu'>Cache</span>(<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/substitute'>quote</a></span>(<span class='fu'><a href='https://www.rdocumentation.org/packages/stats/topics/Normal'>rnorm</a></span>(<span class='kw'>n</span> <span class='kw'>=</span> <span class='fl'>10</span>, <span class='fl'>16</span>)), <span class='kw'>cacheRepo</span> <span class='kw'>=</span> <span class='no'>tmpDir</span>) <span class='co'># recovers cached copy</span></div><div class='output co'>#&gt; <span class='message'></span><span style='color: #0000BB;'>  loading memoised result from previous rnorm call.</span><span></span></div><div class='input'>
<span class='co'>###############################################</span>
<span class='co'># experimental devMode</span>
<span class='co'>###############################################</span>
<span class='no'>opt</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/options'>options</a></span>(<span class='st'>"reproducible.useCache"</span> <span class='kw'>=</span> <span class='st'>"devMode"</span>)
<span class='fu'><a href='viewCache.html'>clearCache</a></span>(<span class='no'>tmpDir</span>, <span class='kw'>ask</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)
<span class='no'>centralTendency</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>x</span>)
  <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/mean'>mean</a></span>(<span class='no'>x</span>)
<span class='no'>funnyData</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='fl'>1</span>,<span class='fl'>1</span>,<span class='fl'>1</span>,<span class='fl'>1</span>,<span class='fl'>10</span>)
<span class='no'>uniqueUserTags</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='st'>"thisIsUnique"</span>, <span class='st'>"reallyUnique"</span>)
<span class='no'>ranNumsB</span> <span class='kw'>&lt;-</span> <span class='fu'>Cache</span>(<span class='no'>centralTendency</span>, <span class='no'>funnyData</span>, <span class='kw'>cacheRepo</span> <span class='kw'>=</span> <span class='no'>tmpDir</span>,
                  <span class='kw'>userTags</span> <span class='kw'>=</span> <span class='no'>uniqueUserTags</span>) <span class='co'># sets new value to Cache</span>
<span class='fu'><a href='viewCache.html'>showCache</a></span>(<span class='no'>tmpDir</span>) <span class='co'># 1 unique artifact -- cacheId is 8be9cf2a072bdbb0515c5f0b3578f474</span></div><div class='output co'>#&gt; <span class='message'>Cache size: </span></div><div class='output co'>#&gt; <span class='message'>  Total (including Rasters): 246 bytes</span></div><div class='output co'>#&gt; <span class='message'>  Selected objects (not including Rasters): 246 bytes</span></div><div class='output co'>#&gt;                             artifact         tagKey
#&gt;  1: 49cde26ceb1f40fa2a552450f35281ee         format
#&gt;  2: 49cde26ceb1f40fa2a552450f35281ee           name
#&gt;  3: 49cde26ceb1f40fa2a552450f35281ee          class
#&gt;  4: 49cde26ceb1f40fa2a552450f35281ee           date
#&gt;  5: 49cde26ceb1f40fa2a552450f35281ee        cacheId
#&gt;  6: 49cde26ceb1f40fa2a552450f35281ee   thisIsUnique
#&gt;  7: 49cde26ceb1f40fa2a552450f35281ee   reallyUnique
#&gt;  8: 49cde26ceb1f40fa2a552450f35281ee       function
#&gt;  9: 49cde26ceb1f40fa2a552450f35281ee    object.size
#&gt; 10: 49cde26ceb1f40fa2a552450f35281ee       accessed
#&gt; 11: 49cde26ceb1f40fa2a552450f35281ee otherFunctions
#&gt; 12: 49cde26ceb1f40fa2a552450f35281ee otherFunctions
#&gt; 13: 49cde26ceb1f40fa2a552450f35281ee otherFunctions
#&gt; 14: 49cde26ceb1f40fa2a552450f35281ee otherFunctions
#&gt; 15: 49cde26ceb1f40fa2a552450f35281ee otherFunctions
#&gt; 16: 49cde26ceb1f40fa2a552450f35281ee otherFunctions
#&gt; 17: 49cde26ceb1f40fa2a552450f35281ee otherFunctions
#&gt; 18: 49cde26ceb1f40fa2a552450f35281ee otherFunctions
#&gt; 19: 49cde26ceb1f40fa2a552450f35281ee otherFunctions
#&gt; 20: 49cde26ceb1f40fa2a552450f35281ee otherFunctions
#&gt; 21: 49cde26ceb1f40fa2a552450f35281ee otherFunctions
#&gt; 22: 49cde26ceb1f40fa2a552450f35281ee      preDigest
#&gt; 23: 49cde26ceb1f40fa2a552450f35281ee      preDigest
#&gt;                             artifact         tagKey
#&gt;                             tagValue         createdDate
#&gt;  1:                              rda 2019-03-18 10:05:55
#&gt;  2: 49cde26ceb1f40fa2a552450f35281ee 2019-03-18 10:05:55
#&gt;  3:                          numeric 2019-03-18 10:05:55
#&gt;  4:              2019-03-18 10:05:55 2019-03-18 10:05:55
#&gt;  5:                 71cd24ec3b0d0cac 2019-03-18 10:05:55
#&gt;  6:                     thisIsUnique 2019-03-18 10:05:55
#&gt;  7:                     reallyUnique 2019-03-18 10:05:55
#&gt;  8:                  centralTendency 2019-03-18 10:05:55
#&gt;  9:                              984 2019-03-18 10:05:55
#&gt; 10:              2019-03-18 10:05:55 2019-03-18 10:05:55
#&gt; 11:                          saveRDS 2019-03-18 10:05:55
#&gt; 12:                          do.call 2019-03-18 10:05:55
#&gt; 13:                 build_site_local 2019-03-18 10:05:55
#&gt; 14:                  build_reference 2019-03-18 10:05:55
#&gt; 15:             data_reference_topic 2019-03-18 10:05:55
#&gt; 16:                          as_data 2019-03-18 10:05:55
#&gt; 17:             as_data.tag_examples 2019-03-18 10:05:55
#&gt; 18:                        timing_fn 2019-03-18 10:05:55
#&gt; 19:                           handle 2019-03-18 10:05:55
#&gt; 20:                              try 2019-03-18 10:05:55
#&gt; 21:                      withVisible 2019-03-18 10:05:55
#&gt; 22:               x:e4aa8de28dc6c1bb 2019-03-18 10:05:55
#&gt; 23:            .FUN:d5f5f91cbb662db9 2019-03-18 10:05:55
#&gt;                             tagValue         createdDate</div><div class='input'>
<span class='co'># During development, we often redefine function internals</span>
<span class='no'>centralTendency</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>x</span>)
  <span class='fu'><a href='https://www.rdocumentation.org/packages/stats/topics/median'>median</a></span>(<span class='no'>x</span>)
<span class='co'># When we rerun, we don't want to keep the "old" cache because the function will</span>
<span class='co'>#   never again be defined that way. Here, because of userTags being the same,</span>
<span class='co'>#   it will replace the entry in the Cache, effetively overwriting it, even though</span>
<span class='co'>#   it has a different cacheId</span>
<span class='no'>ranNumsD</span> <span class='kw'>&lt;-</span> <span class='fu'>Cache</span>(<span class='no'>centralTendency</span>, <span class='no'>funnyData</span>, <span class='kw'>cacheRepo</span> <span class='kw'>=</span> <span class='no'>tmpDir</span>, <span class='kw'>userTags</span> <span class='kw'>=</span> <span class='no'>uniqueUserTags</span>)</div><div class='output co'>#&gt; <span class='message'>This call to cache differs from the next closest due to:</span></div><div class='output co'>#&gt; <span class='message'>... different .FUN</span></div><div class='output co'>#&gt; <span class='message'>Overwriting Cache entry with userTags: 'thisIsUnique, reallyUnique, function:centralTendency'</span></div><div class='input'><span class='fu'><a href='viewCache.html'>showCache</a></span>(<span class='no'>tmpDir</span>) <span class='co'># 1 unique artifact -- cacheId is bb1195b40c8d37a60fd6004e5d526e6b</span></div><div class='output co'>#&gt; <span class='message'>Cache size: </span></div><div class='output co'>#&gt; <span class='message'>  Total (including Rasters): 246 bytes</span></div><div class='output co'>#&gt; <span class='message'>  Selected objects (not including Rasters): 246 bytes</span></div><div class='output co'>#&gt;                             artifact         tagKey
#&gt;  1: ba72850f0c54ec67f8a00614cd17f365         format
#&gt;  2: ba72850f0c54ec67f8a00614cd17f365           name
#&gt;  3: ba72850f0c54ec67f8a00614cd17f365          class
#&gt;  4: ba72850f0c54ec67f8a00614cd17f365           date
#&gt;  5: ba72850f0c54ec67f8a00614cd17f365        cacheId
#&gt;  6: ba72850f0c54ec67f8a00614cd17f365   thisIsUnique
#&gt;  7: ba72850f0c54ec67f8a00614cd17f365   reallyUnique
#&gt;  8: ba72850f0c54ec67f8a00614cd17f365       function
#&gt;  9: ba72850f0c54ec67f8a00614cd17f365    object.size
#&gt; 10: ba72850f0c54ec67f8a00614cd17f365       accessed
#&gt; 11: ba72850f0c54ec67f8a00614cd17f365 otherFunctions
#&gt; 12: ba72850f0c54ec67f8a00614cd17f365 otherFunctions
#&gt; 13: ba72850f0c54ec67f8a00614cd17f365 otherFunctions
#&gt; 14: ba72850f0c54ec67f8a00614cd17f365 otherFunctions
#&gt; 15: ba72850f0c54ec67f8a00614cd17f365 otherFunctions
#&gt; 16: ba72850f0c54ec67f8a00614cd17f365 otherFunctions
#&gt; 17: ba72850f0c54ec67f8a00614cd17f365 otherFunctions
#&gt; 18: ba72850f0c54ec67f8a00614cd17f365 otherFunctions
#&gt; 19: ba72850f0c54ec67f8a00614cd17f365 otherFunctions
#&gt; 20: ba72850f0c54ec67f8a00614cd17f365 otherFunctions
#&gt; 21: ba72850f0c54ec67f8a00614cd17f365 otherFunctions
#&gt; 22: ba72850f0c54ec67f8a00614cd17f365      preDigest
#&gt; 23: ba72850f0c54ec67f8a00614cd17f365      preDigest
#&gt;                             artifact         tagKey
#&gt;                             tagValue         createdDate
#&gt;  1:                              rda 2019-03-18 10:05:56
#&gt;  2: ba72850f0c54ec67f8a00614cd17f365 2019-03-18 10:05:56
#&gt;  3:                          numeric 2019-03-18 10:05:56
#&gt;  4:              2019-03-18 10:05:56 2019-03-18 10:05:56
#&gt;  5:                 632cd06f30e111be 2019-03-18 10:05:56
#&gt;  6:                     thisIsUnique 2019-03-18 10:05:56
#&gt;  7:                     reallyUnique 2019-03-18 10:05:56
#&gt;  8:                  centralTendency 2019-03-18 10:05:56
#&gt;  9:                              984 2019-03-18 10:05:56
#&gt; 10:              2019-03-18 10:05:56 2019-03-18 10:05:56
#&gt; 11:                          saveRDS 2019-03-18 10:05:56
#&gt; 12:                          do.call 2019-03-18 10:05:56
#&gt; 13:                 build_site_local 2019-03-18 10:05:56
#&gt; 14:                  build_reference 2019-03-18 10:05:56
#&gt; 15:             data_reference_topic 2019-03-18 10:05:56
#&gt; 16:                          as_data 2019-03-18 10:05:56
#&gt; 17:             as_data.tag_examples 2019-03-18 10:05:56
#&gt; 18:                        timing_fn 2019-03-18 10:05:56
#&gt; 19:                           handle 2019-03-18 10:05:56
#&gt; 20:                              try 2019-03-18 10:05:56
#&gt; 21:                      withVisible 2019-03-18 10:05:56
#&gt; 22:               x:e4aa8de28dc6c1bb 2019-03-18 10:05:56
#&gt; 23:            .FUN:af11d20d957667d9 2019-03-18 10:05:56
#&gt;                             tagValue         createdDate</div><div class='input'>
<span class='co'># If it finds it by cacheID, doesn't matter what the userTags are</span>
<span class='no'>ranNumsD</span> <span class='kw'>&lt;-</span> <span class='fu'>Cache</span>(<span class='no'>centralTendency</span>, <span class='no'>funnyData</span>, <span class='kw'>cacheRepo</span> <span class='kw'>=</span> <span class='no'>tmpDir</span>, <span class='kw'>userTags</span> <span class='kw'>=</span> <span class='st'>"thisIsUnique"</span>)</div><div class='output co'>#&gt; <span class='message'></span><span style='color: #0000BB;'>  loading cached result from previous centralTendency call, adding to memoised copy</span><span></span></div><div class='input'>
<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/options'>options</a></span>(<span class='no'>opt</span>)

<span class='co'># For more in depth uses, see vignette</span></div></span><span class='co'># NOT RUN {</span>
  <span class='fu'><a href='https://www.rdocumentation.org/packages/utils/topics/browseVignettes'>browseVignettes</a></span>(<span class='kw'>package</span> <span class='kw'>=</span> <span class='st'>"reproducible"</span>)
<span class='co'># }</span><div class='input'><span class='co'># Equivalent</span>
<span class='no'>a</span> <span class='kw'>&lt;-</span> <span class='fu'>Cache</span>(<span class='no'>rnorm</span>, <span class='fl'>1</span>)</div><div class='output co'>#&gt; <span class='message'><span style='color: #0000BB;'>  loading cached result from previous rnorm call, adding to memoised copy</span><span></span></div><div class='input'><span class='no'>b</span> <span class='kw'>%&lt;%</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/stats/topics/Normal'>rnorm</a></span>(<span class='fl'>1</span>)</div><div class='output co'>#&gt; <span class='message'></span><span style='color: #0000BB;'>  loading memoised result from previous rnorm call.</span><span></span></div><div class='input'>
</div></span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>

      <li><a href="#note">Note</a></li>

      <li><a href="#nested-caching">Nested Caching</a></li>

      <li><a href="#caching-speed">Caching Speed</a></li>

      <li><a href="#filepaths">Filepaths</a></li>

      <li><a href="#stochasticity">Stochasticity</a></li>

      <li><a href="#usecache">useCache</a></li>

      <li><a href="#sideeffect"><code>sideEffect</code></a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    <p>Eliot McIntire</p>
  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Eliot J B McIntire, Alex M Chubaty.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
   </div>

  

  </body>
</html>

